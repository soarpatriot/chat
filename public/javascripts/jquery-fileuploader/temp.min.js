

$('#fileupload').fileupload('option', {

    maxFileSize: 10000000,
    //acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
    acceptFileTypes: /^image\/(gif|jpeg|png)$/,

    process: [
        {
            action: 'load',
            fileTypes: /^image\/(gif|jpeg|png)$/,
            maxFileSize: 10000000 // 10MB
        },
        {
            action: 'resize',
            maxWidth: 1440,
            maxHeight: 900
        },
        {
            action: 'save'
        }
    ]
});




dataType: 'json',
    add: function (e, data) {

    clearDisplay();

    var fileTmp = _.template($('#file-template').html());
    $('#upload-div').append(fileTmp(obtainFileInfo(data.files[0])));

    var loadingImage = loadImage(
        data.files[0],
        function (img) {
            var $image = $(img);
            $image.addClass('img-responsive').addClass('img-thumbnail');
            $('#display-area').append($image);
        },
        {   maxWidth:140,
            maxHeight:140,
            canvas:true
        }
    );
    //loadingImage.onload = loadingImage.onerror = null;
    /*
     $.each(data.files, function (index, file) {
     $('<p/>').text(file.name).appendTo($("#upload-result"));
     });**/
    /**
     *  {"name":"flamingo (13).js","originalName":"flamingo.js",
             *  "size":79998,"type":"application/javascript","delete_type":"DELETE",
             *  "url":"http://localhost:3000/upload/flamingo%20(13).js",
             *  "delete_url":"http://localhost:3000/upload/flamingo%20(13).js"}
     * @type {*}
     */
    var jqXHR = data.submit()
        .success(function (result, textStatus, jqXHR) {



        })
        .error(function (jqXHR, textStatus, errorThrown) {

        })
        .complete(function (result, textStatus, jqXHR) {
            console.log("result complete: "+JSON.stringify(result));
            //result = JSON.stringify(result)
            var files = result.responseJSON.files;

            console.log('responseText:'+JSON.stringify(files));
            if(files && files[0]){
                console.log('url:'+files[0].thumbnailUrl);
                $('#image-face').attr('src',files[0].smallUrl);

                var params = {
                    url: files[0].url,
                    deleteUrl: files[0].deleteUrl,
                    smallUrl:files[0].smallUrl,
                    thumbnailUrl: files[0].thumbnailUrl,
                    miniUrl:files[0].miniUrl
                };
                $.ajax({
                    type: 'POST',
                    url: '/users/face',
                    data: params,
                    success: function(res){
                        console.log('success '+res);
                    },
                    dataType: 'json'
                });

            }
        });
    //data.submit();
},

progressall: function (e, data) {
    var progress = parseInt(data.loaded / data.total * 100, 10);
    $('#progress-bar').text(progress+'%');
    $('#progress-bar').attr('aria-valuenow',progress);
    $('#progress-bar').css(
        'width',
        progress + '%'
    );
}